<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <ui:composition template="/WEB-INF/facelets/templates/admin/entidadTemplate.xhtml">
        <ui:define name="title">
            <h:outputText value="Ingrese los parámetros para la consulta inicial sobre Agentes capacitados" />
        </ui:define>
        <ui:define name="content">
            <f:metadata>  
                <f:event listener="#{mbReqAgentes.iniciar}" type="preRenderView"></f:event>  
            </f:metadata>
            <br/>
            <h:form id="frmQuery" style="text-align: left">
                <h:panelGroup id="pnGral" >
                    <p:panel id="pnQuery" header="Ingrese los parámetros para la consulta inicial sobre Agentes capacitados" style="margin-bottom:10px;" toggleable="true">
                        <p:growl id="messages" />
                        <h:panelGrid columns="2">
                            <p:outputLabel value="#{bundle.PersonaLabel_tipoDoc}" for="tipoDoc"/>
                            <p:selectOneMenu id="tipoDoc" value="#{mbReqAgentes.tipoDoc}" >
                                <f:selectItem itemLabel="Seleccione el tipo de documento" itemValue="" noSelectionOption="true" />
                                <f:selectItems value="#{mbReqAgentes.listTipoDoc}" var="tipoDoc" 
                                               itemLabel="#{tipoDoc.nombre}" itemValue="#{tipoDoc}" />
                                <p:ajax event="change" update="numDoc"/>
                            </p:selectOneMenu>    

                            <p:outputLabel value="#{bundle.PersonaLabel_numDoc}" for="numDoc"/>
                            <p:inputText converter="#{Integer}" id="numDoc" disabled="#{mbReqAgentes.tipoDoc == null}"
                                         value="#{mbReqAgentes.numDoc}" >
                            </p:inputText>     
                            
                            <p:outputLabel value="#{bundle.ReqActividades_tipoOrg} :" for="tipoOrg"/>
                            <p:selectOneMenu id="tipoOrg" value="#{mbReqAgentes.tipoOrg}" 
                                             valueChangeListener="#{mbReqAgentes.tipoOrgChangeListener}">
                                <f:selectItem itemLabel="Seleccione el Tipo de Organismo del Agente" itemValue="" noSelectionOption="true" />
                                <f:selectItems value="#{mbReqAgentes.listTipoOrg}" var="tipoOrg" 
                                               itemLabel="#{tipoOrg.nombre}" 
                                               itemValue="#{tipoOrg}"/>
                                <p:ajax event="change" update="organismo"/>
                            </p:selectOneMenu> 

                            <p:outputLabel value="Organismo :" for="organismo"/>
                            <p:selectOneMenu id="organismo" value="#{mbReqAgentes.organismo}">
                                <f:selectItem itemLabel="Seleccione el Organismo del Agente" itemValue="" noSelectionOption="true" />
                                <f:selectItems value="#{mbReqAgentes.listOrg}" var="organismo" 
                                               itemLabel="#{organismo.nombre}" 
                                               itemValue="#{organismo}"/>
                            </p:selectOneMenu> 
                            
                            <p:outputLabel value="Situación de revista :" for="sitRevista"/>
                            <p:selectOneMenu id="sitRevista" value="#{mbReqAgentes.sitRevista}">
                                <f:selectItem itemLabel="Seleccione una situación de revista" itemValue="" noSelectionOption="true" />
                                <f:selectItems value="#{mbReqAgentes.listSitRevista}" var="sitRevista" 
                                               itemLabel="#{sitRevista.nombre}" 
                                               itemValue="#{sitRevista}"/>
                            </p:selectOneMenu> 

                            <p:outputLabel value="Cargo :" for="cargo"/>
                            <p:selectOneMenu id="cargo" value="#{mbReqAgentes.cargo}">
                                <f:selectItem itemLabel="Seleccione un cargo" itemValue="" noSelectionOption="true" />
                                <f:selectItems value="#{mbReqAgentes.listCargo}" var="cargo" 
                                               itemLabel="#{cargo.nombre}" 
                                               itemValue="#{cargo}"/>
                            </p:selectOneMenu> 
                            
                            <p:outputLabel for="fInicioAct" value="Fecha de incio de actividades :" />
                            <p:calendar id="fInicioAct" value="#{mbReqAgentes.fInicioAct}" pattern="dd/MM/yyyy" mask="true" />  
                            
                            <p:outputLabel value="Nivel IPAP :" for="nivelIpap"/>
                            <p:selectOneMenu id="nivelIpap" value="#{mbReqAgentes.nivelIpap}">
                                <f:selectItem itemLabel="Seleccione el nivel alcanzado en el IPAP" itemValue="" noSelectionOption="true" />
                                <f:selectItems value="#{mbReqAgentes.listNivelIpap}" var="nivelIpap" 
                                               itemLabel="#{nivelIpap.nombre}" 
                                               itemValue="#{nivelIpap}"/>
                            </p:selectOneMenu> 
                            
                            <p:outputLabel value="Estudios cursados :" for="estCur"/>
                            <p:selectOneMenu id="estCur" value="#{mbReqAgentes.estCursados}" >
                                <f:selectItem itemLabel="Seleccione un Estudio cursado" itemValue="" noSelectionOption="true" />
                                <f:selectItems value="#{mbReqAgentes.listEstCursados}" var="estCur" 
                                               itemLabel="#{estCur.nombre} - #{estCur.estado}" 
                                               itemValue="#{estCur}"/>
                            </p:selectOneMenu> 

                            <p:outputLabel value="Titulo :" for="titulo"/>
                            <p:selectOneMenu id="titulo" value="#{mbReqAgentes.titulo}" >
                                <f:selectItem itemLabel="Seleccione un Título" itemValue="" noSelectionOption="true" />
                                <f:selectItems value="#{mbReqAgentes.listTitulos}" var="titulo" 
                                               itemLabel="#{titulo.nombre}" 
                                               itemValue="#{titulo}"/>
                            </p:selectOneMenu> 
                            
                            <p:outputLabel value="Es Referente: " />
                            <p:selectBooleanButton id="esReferente" value="#{mbReqAgentes.esReferente}" 
                                               onLabel="Sí" 
                                               offLabel="No" />       

                            <p:outputLabel for="fDespDe" value="Fecha inicial de capacitación :" />
                            <p:calendar id="fDespDe" value="#{mbReqAgentes.fDespuesDe}" pattern="dd/MM/yyyy" mask="true" >
                                <p:ajax event="dateSelect" update="fAntesDe" />
                            </p:calendar>
                            
                            <p:outputLabel for="fAntesDe" value="Fecha final de capacitación :" />
                            <p:calendar id="fAntesDe" value="#{mbReqAgentes.fAntesDe}" pattern="dd/MM/yyyy" mask="true" 
                                        mindate="#{mbReqAgentes.fDespuesDe}" >
                                <f:attribute name="finicial" value="#{mbReqAgentes.fDespuesDe}"/>
                                <f:validator validatorId="primeDateRangeValidator" />
                            </p:calendar>
                            
                            <h:outputLabel value="Resumen general: " rendered="#{mbReqAgentes.consultado}" />
                            <p:commandButton value="Ver" icon="ui-icon-extlink" rendered="#{mbReqAgentes.consultado}"  
                                             actionListener="#{mbReqAgentes.verResGral}" />  
                            
                            <h:outputLabel value="Actividades Dispuestas recibidas: " rendered="#{mbReqAgentes.consultado}" />
                            <p:commandButton value="Listar" icon="ui-icon-extlink" rendered="#{mbReqAgentes.consultado}"  
                                             actionListener="#{mbReqAgentes.verListAdGral}" />  

                        </h:panelGrid>
                    </p:panel>

                    <p:panel header="Resultados de la Búsqueda" rendered="#{mbReqAgentes.consultado}" toggleable="true" style="font-size: 80%" >
                        <p:dataTable id="agetList" value="#{mbReqAgentes.listAgentes}" var="e" rows="5"  
                                     filteredValue="#{mbReqAgentes.listAgentesFilter}" 
                                     paginator="true"
                                     paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     rowsPerPageTemplate="5,10,15">
                            <f:facet name="header">
                                <p:commandButton id="toggler" type="button" value="Columnas" icon="ui-icon-calculator" style="margin-left: 10px" />
                                <p:commandButton icon="ui-icon-refresh" value="Listar" update="agetList" style="margin-left: 10px"/>

                                <h:commandLink>
                                    <p:graphicImage value="/resources/img/icono_excel.gif" width="16"/>
                                    <p:dataExporter type="xls" target="agetList" fileName="ListadoAgentesConsulta" />
                                </h:commandLink>   
                                <h:commandLink>
                                    <p:graphicImage value="/resources/img/icon_pdf.gif" width="16"/>
                                    <p:dataExporter type="pdf" target="agetList" fileName="ListadoAgentesConsulta" preProcessor="#{mbReqAgentes.preProcessPDF}"/>
                                </h:commandLink>  

                                <p:columnToggler datasource="agetList" trigger="toggler" />
                            </f:facet>

                            <p:column headerText="#{bundle.AgenteLabel_apYNom}" sortBy="#{e.apYNom}" filterBy="#{e.apYNom}" filterMatchMode="contains" style="width:160px">
                                <p:outputLabel value="#{e.apYNom}"/>
                            </p:column>   
                            <p:column headerText="#{bundle.AgenteLabel_documento}" sortBy="#{e.documento}" filterBy="#{e.documento}" filterMatchMode="contains">
                                <p:outputLabel value="#{e.documento}"/>
                            </p:column>
                            <p:column headerText="#{bundle.AgenteLabel_sitRevista}" sortBy="#{e.situacionRevista.nombre}" filterBy="#{e.situacionRevista.nombre}" filterMatchMode="contains" style="width:160px">
                                <p:outputLabel value="#{e.situacionRevista.nombre}"/>
                            </p:column>   
                            <p:column headerText="#{bundle.AgenteLabel_cargo}" sortBy="#{e.cargo.nombre}" filterBy="#{e.cargo.nombre}" filterMatchMode="contains" style="width:160px">
                                <p:outputLabel value="#{e.cargo.nombre}"/>
                            </p:column>   
                            <p:column headerText="#{bundle.AgenteLabel_organismo}" sortBy="#{e.organismo.nombre}" filterBy="#{e.organismo.nombre}" filterMatchMode="contains">
                                <p:outputLabel value="#{e.organismo.nombre}"/>
                            </p:column>
                            <p:column headerText="#{bundle.AgenteLabel_estCursados}" sortBy="#{e.estudiosCursados.nombre}" filterBy="#{e.estudiosCursados.nombre}" filterMatchMode="contains">
                                <p:outputLabel value="#{e.estudiosCursados.nombre}"/>
                            </p:column>
                            <p:column headerText="#{bundle.AgenteLabel_estCursadosEstado}" sortBy="#{e.estudiosCursados.estado}" filterBy="#{e.estudiosCursados.estado}" filterMatchMode="contains">
                                <p:outputLabel value="#{e.estudiosCursados.estado}"/>
                            </p:column>
                            <p:column headerText="#{bundle.AgenteLabel_titulo}" sortBy="#{e.titulo.nombre}" filterBy="#{e.titulo.nombre}" filterMatchMode="contains">
                                <p:outputLabel value="#{e.titulo.nombre}"/>
                            </p:column>
                            <p:column headerText="#{bundle.AgenteLabel_nivelIpap}" sortBy="#{e.nivelIpap.nombre}" filterBy="#{e.nivelIpap.nombre}" filterMatchMode="contains">
                                <p:outputLabel value="#{e.nivelIpap.nombre}"/>
                            </p:column>  
                            <p:column headerText="Antigüedad">
                                <p:outputLabel value="#{e.antigMeses} meses" rendered="#{e.antigMeses > 0}"/>
                                <p:outputLabel value="#{e.antigAnios} años" rendered="#{e.antigAnios > 0}"/>
                            </p:column>

                            <p:column headerText="Ampliar" style="width:130px" exportable="false">
                                <p:growl id="messages" showDetail="true" />
                                <p:commandButton icon="ui-icon-zoomin" action="#{mbReqAgentes.verResGralAgente}" title="Ver Resumen">
                                    <f:setPropertyActionListener value="#{e}" target="#{mbReqAgentes.current}" />
                                </p:commandButton>
                                <p:commandButton icon="ui-icon-lightbulb" action="#" update="messages" title="Ver Actividades recibidas" >
                                    <f:setPropertyActionListener value="#{e}" target="#{mbReqAgentes.current}" />
                                </p:commandButton>  
                                <p:commandButton icon="ui-icon-suitcase" action="#" title="Ver Programas vinculados">
                                    <f:setPropertyActionListener value="#{e}" target="#{mbReqAgentes.current}" />
                                </p:commandButton>
                                <p:commandButton icon="ui-icon-home" action="#" update="messages" title="Ver Sedes asistidas" >
                                    <f:setPropertyActionListener value="#{e}" target="#{mbReqAgentes.current}" />
                                </p:commandButton>                     
                            </p:column>                
                        </p:dataTable>
                    </p:panel>
                </h:panelGroup>
             
                <p:toolbar>
                    <f:facet name="left">
                        <p:commandButton icon="ui-icon-check" value="Consultar" actionListener="#{mbReqAgentes.buscar}" update="pnGral" />
                        <p:commandButton icon="ui-icon-cancel" value="Limpiar" action="#{mbReqAgentes.reset}" update="pnGral" style="float: right">
                            <p:ajax resetValues="true" />
                        </p:commandButton>
                    </f:facet>
                </p:toolbar>
                
            </h:form>
        </ui:define>
    </ui:composition>
</html>

